<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Chess Demo · Option 2 — Silhouette-only (max readability)</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<style>
:root { color-scheme: light; }
html, body { margin:0; height:100%; background:#f6f6f6; font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; }
.app { max-width:900px; margin:0 auto; padding:16px; display:grid; gap:12px; }

h1 { margin:0; font-size:18px; font-weight:600; }
.sub { margin:0; font-size:13px; color:#666; }

.toolbar{ display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
.leftStack{ display:flex; align-items:center; gap:10px; }
.turnPill{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 12px; border-radius:999px;
  border:1px solid rgba(0,0,0,0.14);
  background: rgba(255,255,255,0.88);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  font-size:13px; color:#111;
}
.turnDot{ width:10px; height:10px; border-radius:999px; background:#111; opacity:0.9; }
.turnDot.black{ background:#111; }
.turnDot.white{ background:#fff; border:1px solid rgba(0,0,0,0.22); }

.btns{ display:flex; gap:10px; flex-wrap:wrap; }
button.ui{
  font:inherit; padding:10px 14px; border-radius:14px;
  border:1px solid rgba(0,0,0,0.18);
  background:rgba(255,255,255,0.9);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
button.ui:disabled{ opacity:0.5; }
button.ui.danger{ border-color: rgba(255,0,0,0.25); }

.board {
  width:min(92vw,560px);
  aspect-ratio:1/1;
  display:grid;
  grid-template-columns:repeat(8,1fr);
  grid-template-rows:repeat(8,1fr);
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 12px 32px rgba(0,0,0,.12);
}

.sq {
  border:0; padding:0; margin:0; background:none;
  position:relative; display:grid; place-items:center;
  touch-action:manipulation;
}

.light { background:#f1dcc0; }
.dark  { background:#b48a64; }

.selected { outline:3px solid #3b82f6; outline-offset:-3px; }
.incheck { outline:3px solid #ef4444; outline-offset:-3px; }

.dot {
  position:absolute;
  width:22%; height:22%;
  border-radius:999px;
  background:rgba(0,0,0,.28);
  opacity:0; pointer-events:none;
}
.target .dot { opacity:1; }
.target.capture .dot {
  width:70%; height:70%;
  background:none;
  border:3px solid rgba(0,0,0,.36);
}

.piece { pointer-events:none; display:grid; place-items:center; }
.piece[data-t="p"]{ width:64%; height:64%; }
.piece[data-t="n"], .piece[data-t="b"]{ width:78%; height:78%; }
.piece[data-t="r"]{ width:82%; height:82%; }
.piece[data-t="q"], .piece[data-t="k"]{ width:88%; height:88%; }
.piece svg { width:100%; height:100%; display:block; }
.coord { display:none; }

/* Promotion UI */
.promoOverlay{
  position:fixed; inset:0;
  display:none; align-items:center; justify-content:center;
  background: rgba(0,0,0,0.22);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  z-index:999;
}
.promoOverlay.show{ display:flex; }
.promoPanel{
  width:min(92vw, 440px);
  border-radius:18px;
  background: rgba(255,255,255,0.94);
  border:1px solid rgba(0,0,0,0.12);
  box-shadow: 0 18px 60px rgba(0,0,0,0.22);
  padding:14px;
}
.promoHeader{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; }
.promoTitle{ font-size:14px; font-weight:600; color:#111; }
.promoSub{ font-size:12px; color:#666; margin-top:2px; }
.promoClose{
  width:40px; height:40px;
  border-radius:12px;
  border:1px solid rgba(0,0,0,0.12);
  background: rgba(255,255,255,0.85);
  font-size:18px;
}
.promoGrid{ display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; }
.promoBtn{
  border:1px solid rgba(0,0,0,0.12);
  background: rgba(255,255,255,0.90);
  border-radius:16px;
  padding:10px 8px;
  display:grid; gap:6px; place-items:center;
}
.promoBtn:active{ transform: scale(0.98); }
.promoIcon{ width:60px; height:60px; display:grid; place-items:center; }
.promoIcon .piece{ width:100%; height:100%; }
.promoLabel{ font-size:12px; color:#333; letter-spacing:0.2px; }
</style>
</head>

<body>
<div class="app">
  <h1>Chess board MVP v1</h1>
  <p class="sub">Option 2 — Silhouette-only (max readability) · built for readability in motion + sunlight</p>

  <div class="toolbar">
    <div class="leftStack">
      <div class="turnPill" id="turnPill">
        <span class="turnDot white" id="turnDot"></span>
        <span id="turnText">Turn: White</span>
      </div>
    </div>
    <div class="btns">
      <button class="ui" id="undoBtn" type="button">Undo</button>
      <button class="ui danger" id="resetBtn" type="button">Reset</button>
    </div>
  </div>

  <div class="board" id="board" aria-label="Chess board"></div>
</div>


<!-- Game state modal -->
<div class="promoOverlay" id="gameStateOverlay" role="dialog" aria-modal="true" aria-label="Game state">
  <div class="promoPanel">
    <div class="promoHeader">
      <div>
        <div class="promoTitle" id="gameStateTitle">Game state</div>
        <div class="promoSub" id="gameStateSub"></div>
      </div>
      <button class="promoClose" id="gameStateClose" type="button" aria-label="Close">✕</button>
    </div>
    <div style="display:flex;gap:12px;justify-content:flex-end">
      <button class="ui" id="gameStateOk">OK</button>
    </div>
  </div>
</div>

<div class="promoOverlay" id="promoOverlay"
 role="dialog" aria-modal="true" aria-label="Promotion">
  <div class="promoPanel">
    <div class="promoHeader">
      <div>
        <div class="promoTitle">Choose promotion</div>
        <div class="promoSub" id="promoSub">Select a piece</div>
      </div>
      <button class="promoClose" id="promoClose" type="button" aria-label="Close">✕</button>
    </div>
    <div class="promoGrid" id="promoGrid"></div>
  </div>
</div>

<script>
const game = new Chess();
const files = ["a","b","c","d","e","f","g","h"];
const boardEl = document.getElementById("board");
const undoBtn = document.getElementById("undoBtn");
const resetBtn = document.getElementById("resetBtn");
const turnTextEl = document.getElementById("turnText");
const turnDotEl = document.getElementById("turnDot");

const promoOverlay = document.getElementById("promoOverlay");
const promoClose = document.getElementById("promoClose");
const promoGrid = document.getElementById("promoGrid");
const promoSub = document.getElementById("promoSub");

function sqFromIdx(i){ return files[i%8] + (8 - Math.floor(i/8)); }
function isLight(i){ return (Math.floor(i/8) + (i%8)) % 2 === 0; }


function wrapSVG(kind, d, color){
  const fill = (color==="w") ? "#ffffff" : "#0b1220";
  const outline = (color==="w") ? "rgba(0,0,0,0.22)" : "rgba(255,255,255,0.22)";
  return `
  <svg viewBox="0 0 100 100" aria-hidden="true" focusable="false">
    <path d="${d}" fill="${fill}"></path>
    <path d="${d}" fill="none" stroke="${outline}" stroke-width="3" stroke-linejoin="round"></path>
  </svg>`;
}
function P(color){
  const d = "M50 18 C60 18 68 26 68 36 C68 44 62 50 56 54 C62 58 66 64 66 72 C66 80 60 84 50 84 C40 84 34 80 34 72 C34 64 38 58 44 54 C38 50 32 44 32 36 C32 26 40 18 50 18 Z M26 84 H74 C79 84 82 87 82 92 C82 97 79 100 74 100 H26 C21 100 18 97 18 92 C18 87 21 84 26 84 Z";
  return wrapSVG("p", d, color);
}
function R(color){
  const d = "M24 24 H76 V40 H68 V30 H60 V40 H40 V30 H32 V40 H24 Z M32 40 H68 V76 C68 84 62 88 54 88 H46 C38 88 32 84 32 76 Z M20 88 H80 C86 88 90 92 90 98 C90 99 89 100 88 100 H12 C11 100 10 99 10 98 C10 92 14 88 20 88 Z";
  return wrapSVG("r", d, color);
}
function B(color){
  const d = "M50 16 C64 26 66 40 56 48 C66 54 68 66 60 74 C56 80 53 83 50 86 C47 83 44 80 40 74 C32 66 34 54 44 48 C34 40 36 26 50 16 Z M22 86 H78 C84 86 88 90 88 96 C88 99 86 100 84 100 H16 C14 100 12 99 12 96 C12 90 16 86 22 86 Z";
  return wrapSVG("b", d, color);
}
function N(color){
  const d = "M70 24 C60 18 44 26 38 38 C34 46 34 58 36 66 C26 68 18 74 18 82 C18 90 24 94 34 94 H66 C78 94 86 86 84 76 C82 64 72 58 60 56 C62 48 72 44 84 42 C86 34 80 26 70 24 Z M22 94 H78 C84 94 88 97 88 100 H12 C12 97 16 94 22 94 Z";
  return wrapSVG("n", d, color);
}
function Q(color){
  const d = "M26 32 C28 26 34 24 40 26 L46 20 C48 16 52 16 54 20 L60 26 C66 24 72 26 74 32 L68 72 C66 82 58 86 50 88 C42 86 34 82 32 72 Z M18 88 H82 C88 88 92 92 92 98 C92 99 91 100 90 100 H10 C9 100 8 99 8 98 C8 92 12 88 18 88 Z";
  return wrapSVG("q", d, color);
}
function K(color){
  const d = "M46 14 H54 V24 H66 V32 H54 V44 H46 V32 H34 V24 H46 Z M34 46 C34 34 44 30 50 30 C56 30 66 34 66 46 C66 60 58 70 50 80 C42 70 34 60 34 46 Z M18 80 H82 C88 80 92 84 92 90 C92 97 88 100 82 100 H18 C12 100 8 97 8 90 C8 84 12 80 18 80 Z";
  return wrapSVG("k", d, color);
}



function findKingSquare(color){
  // Scan board to find king square for given color ("w" or "b")
  const b = game.board(); // 8x8 from rank 8 to 1
  for(let r=0;r<8;r++){
    for(let f=0;f<8;f++){
      const p = b[r][f];
      if(p && p.type==="k" && p.color===color){
        const file = files[f];
        const rank = 8 - r;
        return file + String(rank);
      }
    }
  }
  return null;
}
function updateCheckHighlight(){
  checkedKingSq = null;
  // Only highlight for check (not mate/stalemate)
  if (game.in_check() && !game.in_checkmate() && !game.in_stalemate()){
    checkedKingSq = findKingSquare(game.turn()); // side to move is in check
  }
}

function pieceSVG(p){
  if(!p) return "";
  const c = p.color;
  switch(p.type){
    case "p": return P(c);
    case "r": return R(c);
    case "n": return N(c);
    case "b": return B(c);
    case "q": return Q(c);
    case "k": return K(c);
    default: return "";
  }
}

let selected=null, legal=new Set(), captures=new Set();

let pendingPromotion = null;
let gameStateLock = false;

function showGameState(title, sub){
  gameStateLock = true;
  document.getElementById("gameStateTitle").textContent = title;
  document.getElementById("gameStateSub").textContent = sub || "";
  document.getElementById("gameStateOverlay").classList.add("show");
}
function hideGameState(){
  gameStateLock = false;
  document.getElementById("gameStateOverlay").classList.remove("show");
}

function checkGameEnd(){
  // Modal only for terminal states
  if (game.in_checkmate()){
    showGameState("Checkmate", game.turn()==="w" ? "Black wins" : "White wins");
    return;
  }
  if (game.in_stalemate()){
    showGameState("Stalemate", "Draw");
    return;
  }
  // Non-terminal: no modal. King highlight handled in render().
}


function updateTurn(){
  const white = game.turn()==="w";
  turnTextEl.textContent = `Turn: ${white ? "White" : "Black"}`;
  turnDotEl.className = "turnDot " + (white ? "white" : "black");
}

function computeLegal(fromSq){
  const moves = game.moves({ square: fromSq, verbose: true });
  legal = new Set(moves.map(m => m.to));
  captures = new Set(moves.filter(m => (m.flags.includes("c") || m.flags.includes("e"))).map(m => m.to));
}

function render(){
  updateTurn();
  updateCheckHighlight();
  undoBtn.disabled = game.history().length === 0;

  boardEl.innerHTML = "";
  for(let i=0;i<64;i++){
    const sq = sqFromIdx(i);
    const p = game.get(sq);

    const b = document.createElement("button");
    b.type = "button";
    b.className = "sq " + (isLight(i) ? "light" : "dark");
    if(selected===sq) b.classList.add("selected");
    if(checkedKingSq===sq) b.classList.add("incheck");
    if(legal.has(sq)) b.classList.add("target");
    if(captures.has(sq)) b.classList.add("capture");

    const piece = document.createElement("span");
    piece.className = "piece";
    piece.dataset.t = p ? p.type : "";
    piece.innerHTML = pieceSVG(p);

    const dot = document.createElement("span");
    dot.className = "dot";

    b.append(piece, dot);
    b.onpointerdown = (e) => {
      e.preventDefault();
      if (pendingPromotion || gameStateLock) return;
      tap(sq);
    };

    boardEl.appendChild(b);
  }
}

function openPromotionPanel(from, to, color){
  pendingPromotion = {from, to, color};
  promoSub.textContent = `Promote pawn on ${to.toUpperCase()}`;
  promoGrid.innerHTML = "";

  const options = [
    {type:"q", label:"Queen"},
    {type:"r", label:"Rook"},
    {type:"b", label:"Bishop"},
    {type:"n", label:"Knight"},
  ];

  for(const opt of options){
    const btn = document.createElement("button");
    btn.type="button";
    btn.className="promoBtn";

    const icon = document.createElement("div");
    icon.className="promoIcon";
    const piece = document.createElement("span");
    piece.className = "piece";
    piece.dataset.t = opt.type;
    piece.innerHTML = pieceSVG({type: opt.type, color});
    icon.appendChild(piece);

    const label = document.createElement("div");
    label.className="promoLabel";
    label.textContent = opt.label;

    btn.append(icon, label);
    btn.addEventListener("click", ()=>commitPromotion(opt.type));
    promoGrid.appendChild(btn);
  }

  promoOverlay.classList.add("show");
}

function closePromotionPanel(){
  promoOverlay.classList.remove("show");
  pendingPromotion = null;
}

function commitPromotion(promoType){
  if(!pendingPromotion) return;
  const {from,to} = pendingPromotion;
  game.move({from, to, promotion: promoType});
  closePromotionPanel();
  selected=null; legal.clear(); captures.clear();
  render(); checkGameEnd();
}

promoClose.addEventListener("click", ()=>{
  closePromotionPanel();
  selected=null; legal.clear(); captures.clear();
  render();
});
promoOverlay.addEventListener("pointerdown", (e)=>{
  if(e.target === promoOverlay) promoClose.click();
});

function tap(sq){
  if(!selected){
    const p = game.get(sq);
    if(!p || p.color !== game.turn()) return;
    selected = sq;
    computeLegal(sq);
    render(); return;
  }

  if(selected === sq){
    selected=null; legal.clear(); captures.clear();
    render(); return;
  }

  if(legal.has(sq)){
    const from = selected;
    const fromPiece = game.get(from);
    const needsPromo = fromPiece && fromPiece.type==="p" && (sq.endsWith("8") || sq.endsWith("1"));
    if(needsPromo){
      openPromotionPanel(from, sq, fromPiece.color);
      return;
    }
    game.move({from, to: sq});
    selected=null; legal.clear(); captures.clear();
    render(); checkGameEnd(); return;
  }

  const p = game.get(sq);
  if(p && p.color === game.turn()){
    selected = sq;
    computeLegal(sq);
    render(); return;
  }

  selected=null; legal.clear(); captures.clear();
  render();
}

undoBtn.addEventListener("click", ()=>{
  if (pendingPromotion) closePromotionPanel();
  game.undo();
  selected=null; legal.clear(); captures.clear();
  render();
});
resetBtn.addEventListener("click", ()=>{
  if (pendingPromotion) closePromotionPanel();
  game.reset();
  selected=null; legal.clear(); captures.clear();
  render();
});


document.getElementById("gameStateClose").addEventListener("click", hideGameState);
document.getElementById("gameStateOk").addEventListener("click", hideGameState);
document.getElementById("gameStateOverlay").addEventListener("pointerdown", (e)=>{
  if(e.target.id==="gameStateOverlay") hideGameState();
});

render();
</script>
</body>
</html>
